<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font: 13px Helvetica, Arial; }
      form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; }
      form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
      form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
      #messages { list-style-type: none; margin: 0; padding: 0; }
      #messages li { padding: 5px 10px; }
      #messages li:nth-child(odd) { background: #eee; }
      #status-container {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
      }
      
      .status-container--item {
        width: 100px;
        height: 100px;
        padding: 10px;
        background: grey;
        margin-bottom: 1px;
        margin-right: 1px;
        position: relative;
      }
      
      .status-container--item div {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        height: 90%;
        margin-top: 10%;
      }

      .status-container--item:nth-child(odd) {
        background: lightgrey;
      }
      
      .status-container--item .title {
        padding: 3px;
        /*font-size: 8px;*/
        height: 20px;
        text-overflow: ellipsis;
      }
      
      .truthey {
        background: green;
      }

      .falsey {
        background: red;
      }
      .falsey-status-circle {
        height: 15px;
        width: 15px;
        position: absolute;
        top: 6px;
        right: 6px;
        border-radius: 15px;
      }


    </style>
  </head>

  <script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-1.11.1.js"></script>

  <body>
    <ul id="messages"></ul>

    <div id="status-container"></div>
    <form id="chat-form" action="">
      <input id="m" autocomplete="off" /><button>Send</button>
    </form>
  </body>
</html>
<script>
  const generateInnerHtmlForStatusThing = (title, text, truthey) => {
    const trutheyKlas = truthey ? 'truthey' : 'falsey'
    return `
      <div>
        <p class="title">${title}</p>
        <span class="falsey-status-circle ${trutheyKlas}"></span>
        <p>${text}</p>
      </div>
    `
  }

  const createStatusItemElement = (title, content, id, klass, truthey) => {
    const innerHtml = generateInnerHtmlForStatusThing(title, content, truthey)

    return `
      <div id=${id} class=${klass}>
        ${innerHtml}
      </div>
    `
  }
  
  function connectSocket(socketName, cb) {
    var socket = io();
    socket.on(socketName, cb)
    return socket
  }


  const updateFunctionGenerator = (containerId, logString) => {
    return (dataObj) => {
      const container = document.getElementById(containerId)
      Object.keys(dataObj).forEach(k => {
        const snakeCaseKeyName = k.replace(/\s/g, '_')
        const elementId = `${containerId}--item_${snakeCaseKeyName}`
        
        const itemValue = dataObj[k]
        const outputKeyValueString = `${k}: ${itemValue}`
        
        const truthey = Boolean(itemValue)
        const klas = `"${containerId}--item"`
        const title = `${k}`
        const elem = document.getElementById(elementId)

        if(!elem) {

          container.insertAdjacentHTML('beforeend',createStatusItemElement(title, itemValue, elementId, klas, truthey))
        } else {

          const inner = generateInnerHtmlForStatusThing(title, itemValue, truthey)
  
          elem.innerHTML = inner
        } 
      })

      console.log(logString, dataObj)
    }
  }

  const statusContainerId = `status-container`

  const statusUpdateSocketChannelName = `status update`
  const updateStatus = updateFunctionGenerator(statusContainerId, statusUpdateSocketChannelName)  
  connectSocket(statusUpdateSocketChannelName, updateStatus)
</script>